<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:"Cairo",sans-serif;}
body, html{width:100%;height:100%;background:#fafafa;}

header{
    display:flex;justify-content:space-between;align-items:center;
    padding:15px 40px;background:white;box-shadow:0 2px 10px #0001;
    position:sticky;top:0;z-index:10;flex-wrap:wrap;
}
header .logo{font-size:28px;font-weight:800;color:#ff7a33;}
header nav{display:flex;flex-wrap:wrap;gap:15px;}
header nav a{text-decoration:none;font-weight:600;color:#222;transition:.2s;cursor:pointer;}
header nav a:hover{color:#ff7a33;}

.section{
    display:none;opacity:0;transform:scale(0.95);
    transition:opacity .4s ease,transform .4s ease;
    min-height:calc(100vh - 80px);
}
.section.active{display:block;opacity:1;transform:scale(1);}

.hero{
    padding:80px 20px;text-align:center;color:white;
    background:linear-gradient(#ff9a55dd,#ff9a55dd);
}
.hero h1{font-size:36px;}
.hero span{color:#ffe3c6;}
.hero p{margin:10px 0 20px;font-size:16px;}
.cta{
    padding:12px 25px;border:none;background:white;color:#ff7a33;
    font-weight:700;border-radius:6px;font-size:16px;cursor:pointer;transition:.3s;
}
.cta:hover{background:#ffe5d1;}

.categories{padding:40px 20px;width:100%;height:100%;}
.cat-grid{
    display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:20px;width:100%;
}
.cat{
    background:white;padding:20px;border-radius:8px;box-shadow:0 2px 10px #0001;
    text-align:center;font-weight:600;font-size:18px;cursor:pointer;transition:.3s;
    display:flex;justify-content:center;align-items:center;height:150px;
}
.cat:hover{background:#ff7a33;color:white;}

.product-grid{
    display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;
}
.product{
    background:white;border-radius:8px;box-shadow:0 2px 10px #0001;
    text-align:center;display:flex;flex-direction:column;overflow:hidden;
}
.product img{width:100%;max-height:250px;object-fit:cover;}
.product .content{padding:15px;flex:1;}
.product .price{font-weight:700;font-size:16px;color:#ff7a33;margin-bottom:5px;}
.product .phone,.product .whatsapp{color:#888;font-size:14px;margin-bottom:5px;}
.product button{
    margin-top:8px;padding:10px 15px;border:none;background:#25D366;
    color:white;font-weight:700;border-radius:6px;cursor:pointer;transition:.3s;width:100%;
}
.product button:hover{background:#128C7E;}
.deleteBtn{background:#ff3333 !important;}
.editBtn{background:#0066cc !important;}

#addBtn{
    position:fixed;bottom:25px;right:25px;width:65px;height:65px;border:none;
    border-radius:50%;font-size:35px;color:white;background:#ff7a33;
    box-shadow:0 3px 10px #0005;cursor:pointer;display:none;z-index:20;
}
#addBtn:hover{background:#e26a22;}

#formBox{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:#0007;display:none;justify-content:center;align-items:center;
    z-index:30;padding:10px;
}
#formContent{
    width:100%;max-width:450px;background:white;padding:25px;
    border-radius:12px;max-height:90%;overflow-y:auto;box-shadow:0 5px 20px #0004;
}
label.field{
    margin-top:15px;font-weight:700;color:#ff7a33;font-size:15px;display:block;
}
input,textarea{
    width:100%;margin-top:6px;padding:12px;border-radius:6px;
    border:1px solid #bbb;font-size:14px;
}
#imgInput{display:none;}
#imgLabel{
    display:block;width:100%;padding:18px;border:2px dashed #ff7a33;
    border-radius:6px;text-align:center;background:#fff2e6;
    cursor:pointer;transition:.3s;font-size:14px;margin-top:6px;
}
#imgLabel:hover{background:#ffe0cc;border-color:#ff7a33;}
#selectedImageName{font-size:13px;margin-top:8px;color:#333;font-weight:600;}
.submit{
    margin-top:20px;background:#ff7a33;color:white;border:none;
    padding:12px;border-radius:6px;cursor:pointer;width:100%;
    font-size:17px;font-weight:800;letter-spacing:1px;
}
.submit:hover{background:#e26a22;}

/* ØµÙØ­Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ */
.contactBox{
    width:100%;
    min-height:100vh;
    padding:40px 20px;
    background:linear-gradient(#ffb47add,#ff9a55dd);
    display:flex;
    justify-content:center;
    align-items:center;
}
.contactCard{
    background:white;
    width:100%;max-width:550px;
    padding:35px;border-radius:15px;
    box-shadow:0 5px 20px #0003;
    text-align:center;
}
.contactCard h2{
    font-size:30px;color:#ff7a33;font-weight:800;margin-bottom:25px;
}
.contactItem{
    background:#fff5ec;
    padding:18px;
    margin:12px 0;
    border-radius:10px;
    font-size:18px;
    font-weight:700;
    color:#333;
    box-shadow:0 3px 10px #0002;
}
</style>
</head>
<body>

<header>
<div class="logo">Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</div>
<nav>
<a onclick="openPage('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
<a onclick="openPage('categoriesPage')">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a>
<a onclick="openPage('contact')">ØªÙˆØ§ØµÙ„</a>
</nav>
</header>

<div id="home" class="section active">
<section class="hero">
<h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ <span>Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</span></h1>
<p>Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ© Ù„Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù„Ø¹ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
<button class="cta" onclick="openPage('categoriesPage')">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</button>
</section>
</div>

<div id="categoriesPage" class="section">
<section class="categories">
<h2>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h2>

<div class="cat-grid">
<div class="cat" onclick="openCategory('electronics')">Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</div>
<div class="cat" onclick="openCategory('clothes')">Ù…Ù„Ø§Ø¨Ø³</div>
<div class="cat" onclick="openCategory('home')">Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©</div>
<div class="cat" onclick="openCategory('food')">Ø·Ø¹Ø§Ù…</div>
<div class="cat" onclick="openCategory('birds')">Ø·ÙŠÙˆØ±</div>
<div class="cat" onclick="openCategory('other')">ØºÙŠØ± Ø°Ù„Ùƒ</div>
</div>

</section>
</div>

<div id="categoryProducts" class="section">
<h2 style="padding:20px" id="catTitle"></h2>
<div class="product-grid" id="productGrid"></div>
</div>

<!-- ØµÙØ­Ø© ØªÙˆØ§ØµÙ„ -->
<div id="contact" class="section">
<div class="contactBox">
<div class="contactCard">
<h2>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h2>

<div class="contactItem">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: 01211158054</div>
<div class="contactItem">ğŸ’¬ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨: 01211158054</div>
<div class="contactItem">ğŸ“§ Ø§Ù„Ø¬ÙŠÙ…ÙŠÙ„: souqalahmadiya@gmail.com</div>

</div>
</div>
</div>

<button id="addBtn" onclick="openAddForm()">+</button>

<!-- Ù†Ù…ÙˆØ°Ø¬ -->
<div id="formBox">
<div id="formContent">

<h2 id="formTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h2>

<label class="field">ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
<label id="imgLabel" for="imgInput">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
<input type="file" id="imgInput" accept="image/*">
<div id="selectedImageName"></div>

<label class="field">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
<input type="text" id="titleInput">

<label class="field">Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
<input type="text" id="sellerInput">

<label class="field">Ø§Ù„Ø³Ø¹Ø±</label>
<input type="text" id="priceInput">

<label class="field">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input type="text" id="phoneInput">

<label class="field">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
<input type="text" id="whatsappInput">

<label class="field">Ø§Ù„ÙˆØµÙ</label>
<textarea id="descInput"></textarea>

<label class="field">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ù…Ù†ØªØ¬</label>
<input type="password" id="codeInput">

<button class="submit" id="saveBtn">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>

</div></div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const SUPABASE_URL = "https://nzdvboeaocarlcgoeixu.supabase.co";
const SUPABASE_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56ZHZib2Vhb2NhcmxjZ29laXh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NTI3NTAsImV4cCI6MjA4MDMyODc1MH0.mA-hf6902t2xLH_kUedHmy0sQrjGIAmoCqN2rHZ6K_E";

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

let currentCategory = "";
let editingMode = false;
let editingId = null;
let oldImageURL = null;

priceInput.oninput=()=>priceInput.value=priceInput.value.replace(/\D/g,"");
phoneInput.oninput=()=>phoneInput.value=phoneInput.value.replace(/\D/g,"");
whatsappInput.oninput=()=>whatsappInput.value=whatsappInput.value.replace(/\D/g,"");

imgInput.onchange=()=>{
    if(imgInput.files.length){
        selectedImageName.textContent=imgInput.files[0].name;
    }
};

window.openPage=id=>{
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    addBtn.style.display=(id==="categoryProducts")?"block":"none";
};

window.openCategory=cat=>{
    currentCategory=cat;
    let names={
        electronics:"Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª",
        clothes:"Ù…Ù„Ø§Ø¨Ø³",
        home:"Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©",
        food:"Ø·Ø¹Ø§Ù…",
        birds:"Ø·ÙŠÙˆØ±",
        other:"ØºÙŠØ± Ø°Ù„Ùƒ"
    };
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    categoryProducts.classList.add("active");
    catTitle.textContent=names[cat];
    addBtn.style.display="block";
    loadProducts();
};

async function loadProducts(){
    let {data}=await supabase.from("products").select("*").eq("category",currentCategory).order("id",{ascending:false});
    productGrid.innerHTML="";
    if(!data)return;
    data.forEach(p=>{
        let div=document.createElement("div");
        div.className="product";
        div.innerHTML=`
        <img src="${p.image}">
        <div class="content">
            <h3>${p.title}</h3>
            <p>${p.desc}</p>
            <span>Ø§Ù„Ø¨Ø§Ø¦Ø¹: ${p.seller}</span><br>
            <span class="price">${p.price} Ø¬Ù†ÙŠÙ‡</span><br>
            <span class="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${p.phone}</span><br>
            <span class="whatsapp">ÙˆØ§ØªØ³Ø§Ø¨: ${p.whatsapp}</span><br>

            <button onclick="window.open('https://wa.me/2${p.whatsapp}')">ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨</button>
            <button class="editBtn" onclick="editProduct(${p.id})">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="deleteBtn" onclick="deleteProduct(${p.id})">Ø­Ø°Ù</button>
        </div>`;
        productGrid.appendChild(div);
    });
}

window.openAddForm=()=>{
    editingMode=false; editingId=null; oldImageURL=null;
    formTitle.textContent="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬";
    saveBtn.textContent="Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬";
    clearForm();
    formBox.style.display="flex";
};

window.editProduct=async id=>{
    let pass=prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ:");
    let {data}=await supabase.from("products").select("*").eq("id",id).single();
    if(!data || pass!==data.code){
        alert("Ø±Ù…Ø² Ø®Ø·Ø£"); return;
    }
    editingMode=true; editingId=id; oldImageURL=data.image;
    clearForm();
    titleInput.value=data.title;
    sellerInput.value=data.seller;
    priceInput.value=data.price;
    phoneInput.value=data.phone;
    whatsappInput.value=data.whatsapp;
    descInput.value=data.desc;
    codeInput.value=data.code;

    formTitle.textContent="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬";
    saveBtn.textContent="Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
    formBox.style.display="flex";
};

window.deleteProduct=async id=>{
    let pass=prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ:");
    let {data}=await supabase.from("products").select("*").eq("id",id).single();
    if(pass!=="nokiaN95kk" && pass!==data.code){
        alert("Ø±Ù…Ø² Ø®Ø·Ø£"); return;
    }
    await supabase.from("products").delete().eq("id",id);
    loadProducts();
};

saveBtn.onclick=async()=>{
    if(
        titleInput.value.trim()===""||
        sellerInput.value.trim()===""||
        priceInput.value.trim()===""||
        phoneInput.value.trim()===""||
        whatsappInput.value.trim()===""||
        descInput.value.trim()===""
    ){
        alert("Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return;
    }

    let imageURL=oldImageURL;

    if(imgInput.files.length){
        let file=imgInput.files[0];
        let name=Date.now()+"-"+file.name;
        let {error}=await supabase.storage.from("products").upload(name,file);
        if(error){alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");return;}
        imageURL=`${SUPABASE_URL}/storage/v1/object/public/products/${name}`;
    }

    if(editingMode){
        await supabase.from("products").update({
            title:titleInput.value.trim(),
            seller:sellerInput.value.trim(),
            price:priceInput.value.trim(),
            phone:phoneInput.value.trim(),
            whatsapp:whatsappInput.value.trim(),
            desc:descInput.value.trim(),
            code:codeInput.value.trim(),
            image:imageURL
        }).eq("id",editingId);

    } else {
        if(codeInput.value.trim()===""){
            alert("Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ù†ØªØ¬");
            return;
        }
        await supabase.from("products").insert({
            category:currentCategory,
            title:titleInput.value.trim(),
            seller:sellerInput.value.trim(),
            price:priceInput.value.trim(),
            phone:phoneInput.value.trim(),
            whatsapp:whatsappInput.value.trim(),
            desc:descInput.value.trim(),
            code:codeInput.value.trim(),
            image:imageURL
        });
    }

    clearForm();
    formBox.style.display="none";
    loadProducts();
};

function clearForm(){
    imgInput.value="";
    selectedImageName.textContent="";
    titleInput.value="";
    sellerInput.value="";
    priceInput.value="";
    phoneInput.value="";
    whatsappInput.value="";
    descInput.value="";
    codeInput.value="";
    oldImageURL=null;
}

formBox.onclick=e=>{if(e.target===formBox)formBox.style.display="none";}
</script>

</body>
</html>